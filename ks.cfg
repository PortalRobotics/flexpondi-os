# need to set a variable for line 49 - kickstart_server=stl-prod-ops-adm-01.sjultra.com

# Installation source (using CDROM as specified)
cdrom

# Language and keyboard settings
lang en_US.UTF-8
keyboard us

# Network configuration (DHCP, hostname as specified)
network --bootproto=dhcp --hostname=kickstart

# Root password (plaintext as specified)
rootpw --plaintext rocky

# Timezone
timezone America/New_York --utc

# Disable SELinux (as specified)
selinux --disabled

# Text mode (as specified)
text

# Disk partitioning (adjusted for UEFI)
clearpart --all --initlabel
part /boot/efi --fstype=efi --size=200 --asprimary  # EFI System Partition for UEFI
part /boot --fstype=ext4 --size=1024
part / --fstype=ext4 --size=10000 --grow
part swap --fstype=swap --size=2048  # Added swap for stability

# Bootloader location (adjusted for UEFI)
bootloader --location=mbr --boot-drive=vda

# Reboot after installation
reboot

# Packages required (as specified)
%packages
@core
@standard
net-tools
wget
dmidecode
%end

# Post-installation script (unchanged)
%post --interpreter=/bin/bash --log=/mnt/sysroot/root/ks-post.log
wget https://{kickstart_server}/salt-bs-root/opt/synto/sbin/salt-bootstrap >> /root/post-errors.log 
chmod +x ./salt-bootstrap >> /root/post-errors.log
bash ./salt-bootstrap >> /root/post-errors.log
systemctl status salt-minion >> /root/post-errors.log
systemctl restart salt-minion >> /root/post-errors.log
# Set MOTD with a "Welcome to" message, hostname, and UUID (using dmidecode for hardware UUID)
#suffix=$(dmidecode -s system-uuid|tr -d '\n'|tail -c 12)
#hostname="flexpondi-${suffix}"
#hostnamectl set-hostname "$hostname"
#echo "$hostname" > /etc/hostname
UUID=$(dmidecode -s system-uuid)
#echo "Welcome to $HOSTNAME" > /etc/motd
#echo "UUID: $UUID" >> /etc/motd
rm /etc/issue.d/cockpit.issue
echo "PRDC Portal Robotics Flexpondi OS Edition R 0.1.1" > /etc/issue
echo "UUID: $UUID" >> /etc/issue.d/uuid.issue
%end
